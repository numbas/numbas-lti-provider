{% extends "numbas_lti/management/attempt_base.html" %}
{% load i18n %}
{% load icon %}
{% load querystring %}
{% load static %}

{% block title %}{% blocktranslate with name=attempt.user.get_full_name %}Attempt by {{name}}{% endblocktranslate %} - {{block.super}}{% endblock title %}

{% block stylesheets %}
    {{block.super}}
    <link rel="stylesheet" href="{% static 'attempt_scorm_listing.css' %}">
{%endblock stylesheets %}

{% block attempt_content %}

    <p><a class="button link" target="review_attempt" href="{% url_with_lti 'run_attempt' attempt.pk %}"><span class="text-success">{% icon 'play' %} {% translate "Review this attempt" %}</span></a></p>

    <p><a class="button link" href="{% url_with_lti 'attempt_timeline' attempt.pk %}">{% icon 'list' %} {% translate "View activity timeline for this attempt" %}</a></p>

    <p><a class="button primary" href="{% url_with_lti 'attempt_json_dump' attempt.pk %}">{% icon 'save' %} {% translate "Download attempt data in JSON format" %}</a></p>

    <div class="search">
        <label>{% translate "Search for an element:" %} <input class="form-control" id="query" type="text" data-bind="textInput: query"></label>
        <button class="button default quick-query" data-query="learner_response|correct_responses">{% translate "Answers" %}</button>
        <button class="button default quick-query" data-query="(result|weighting)$">{% translate "Part scores" %}</button>
        <button class="button default quick-query" data-query="score.(raw|max)">{% translate "Question scores" %}</button>
    </div>
    <div>
        <label><input type="checkbox" data-bind="checked: most_recent_only"> Most recent value only</label>
    </div>

    <table id="elements">
        <colgroup>
            <col>
            <col style="width:10em;">
            <col style="width:10em;">
        </colgroup>
        <thead>
            <tr>
                <th>Key</th>
                <th>Time</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody id="dynamic-data" data-bind="foreach: show_elements">
            <!-- ko foreach: elements -->
            <tr data-bind="css: {first: $index()==0}">
                <td class="key" data-bind="text: key"></td>
                <td class="time" data-bind="text: time_string"></td>
                <td class="value" data-bind="text: value"></td>
            </tr>
            <!-- /ko -->
        </tbody>
    </table>

{% endblock attempt_content %}

{% block javascripts %}
    <script type="text/javascript" src="{% static 'knockout/knockout.js' %}"></script>

    {% include "numbas_lti/scripts/luxon.html" %}

    <script type="text/javascript" src="{% static 'robust-websocket.js' %}"></script>

    {{elements|json_script:"scorm-elements"}}

    <script>
        var listener_url = '/websocket/attempt/{{attempt.pk}}/scorm_listing';
    </script>

    <script src="{% static 'attempt_scorm_listing.js' %}"></script>
{% endblock javascripts %}
